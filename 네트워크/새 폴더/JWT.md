# JWT 구조

JWT는 JSON Web Token의 약자로, 웹 애플리케이션에서 사용자 인증을 위해 사용되는 표준(RFC 7519) 토큰 형식입니다. 세션 기반 인증과는 다른 방식으로 작동하며, 주로 stateless한 인증 메커니즘을 제공합니다. JWT는 세 개의 부분으로 구성되어 있으며, 각 부분은 Base64로 인코딩된 JSON 객체입니다.

### 1. 헤더 (Header)
* **alg (algorithm):** 사용된 알고리즘을 나타냅니다. 일반적으로 HS256(HMAC SHA-256)이나 RS256(RSA with SHA-256)이 사용됩니다.
* **typ (type):** 토큰의 타입을 나타내며, 일반적으로 "JWT"로 설정됩니다.

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

### 2. 페이로드 (Payload)
* **claims:** 사용자 정보를 담고 있는 부분입니다. 예를 들어, 사용자 ID, 이름, 권한 등을 포함할 수 있습니다.
* **standard claims:** `iss` (issuer), `sub` (subject), `aud` (audience), `exp` (expiration time), `iat` (issued at) 등의 표준 클레임을 사용하여 토큰의 유효성을 검증하고 추가적인 정보를 제공할 수 있습니다.
* **custom claims:** 애플리케이션에서 필요한 추가적인 정보를 포함할 수 있습니다.

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true,
  "iat": 1516239022
}
```

### 3. 서명 (Signature)
* 헤더와 페이로드를 연결하고, 토큰의 무결성을 보장하기 위한 부분입니다.
* 헤더와 페이로드를 Base64로 인코딩한 후, 비밀키를 이용하여 서명을 생성합니다.
* 토큰을 검증할 때 서명을 다시 계산하여 일치하는지 확인합니다.
* 이 서명 덕분에 JWT를 Read-Only 데이터로 취급할 수 있게 된다.

```
Base64UrlEncode(header) + "." + Base64UrlEncode(payload) + "." + Base64UrlEncode(HMACSHA256(
  Base64UrlEncode(header) + "." + Base64UrlEncode(payload),
  secret
))
```

### JWT의 전체 구조 예시
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SGVsbG8gd29ybGQ=
```

# JWT 특성

### JWT의 장점

* **무상태(Stateless) 시스템 구축:** 서버에 사용자 상태를 저장할 필요가 없어 시스템 확장성이 좋고, 서버 부담을 줄일 수 있습니다.
* **분산 시스템에 적합:** 각 서비스가 독립적으로 JWT를 검증하고 사용할 수 있어 마이크로서비스 아키텍처에 적합합니다.
* **보안:** 디지털 서명을 통해 위변조를 방지하고, 필요에 따라 암호화하여 민감한 정보를 보호할 수 있습니다.
* **간편한 구현:** JSON 형식으로 되어 있어 구현이 간단하고, 다양한 언어와 프레임워크에서 라이브러리를 제공합니다.

### JWT의 단점

* **토큰의 크기:** 토큰에 많은 정보를 담을수록 크기가 커져 네트워크 트래픽이 증가할 수 있습니다.
* **토큰 유효 기간:** 토큰의 유효 기간을 짧게 설정하면 사용자 경험이 저하될 수 있고, 너무 길게 설정하면 보안 위험이 증가할 수 있습니다.
* **토큰 탈취 시 위험:** 토큰이 탈취되면 해당 사용자의 권한으로 시스템에 접근할 수 있으므로, 토큰 관리에 주의해야 합니다.
* **복잡한 시나리오:** 세션 관리와 같은 복잡한 시나리오에서는 JWT만으로 해결하기 어려운 경우도 있습니다.

### JWT 사용 시 주의사항

* **민감한 정보는 저장하지 않기:** JWT는 누구나 디코딩할 수 있으므로, 비밀번호와 같은 민감한 정보는 저장하지 않아야 합니다.
* **짧은 유효 기간 설정:** 토큰 유효 기간을 짧게 설정하여 보안 위험을 줄여야 합니다.
* **토큰 갱신:** 토큰이 만료되기 전에 미리 갱신하는 기능을 구현해야 합니다.
* **토큰 탈취 방지:** HTTPS를 사용하고, CSRF 공격을 방지하는 등의 보안 조치를 취해야 합니다.
* **로그아웃 기능:** 사용자가 로그아웃할 때 토큰을 무효화하는 기능을 구현해야 합니다.

**결론적으로 JWT는 간편하고 유연한 인증 방식이지만, 보안에 대한 충분한 고려가 필요합니다.** 시스템의 특성과 보안 요구사항에 맞게 JWT를 적절히 사용해야 합니다.

# JWT 인증 과정

1. 사용자 로그인:
   - 사용자가 아이디와 비밀번호를 입력하여 로그인을 시도합니다.

2. 서버의 인증 및 JWT 생성:
   - 서버는 제공된 자격 증명을 확인합니다.
   - 인증이 성공하면, 서버는 `JWT(Access Token이라고도 부름)`를 생성합니다.
   - JWT는 일반적으로 헤더(Header), 페이로드(Payload), 서명(Signature)의 세 부분으로 구성됩니다.

3. JWT 전송:
   - 서버는 생성된 JWT를 클라이언트에게 응답으로 전송합니다.
   - 이는 주로 HTTP 응답 본문이나 헤더를 통해 이루어집니다.

4. 클라이언트의 JWT 저장:
   - 클라이언트는 받은 JWT를 저장합니다.
   - 저장 위치는 주로 브라우저의 localStorage, sessionStorage, 또는 보안 쿠키입니다.

5. 후속 요청에 JWT 포함:
   - 클라이언트는 서버에 요청을 보낼 때마다 저장된 JWT를 포함시킵니다.
   - 주로 HTTP Authorization 헤더에 "Bearer [JWT]" 형식으로 포함됩니다.

6. 서버의 JWT 검증:
   - 서버는 요청에 포함된 JWT를 추출합니다.
   - JWT의 서명을 확인하여 토큰의 무결성을 검증합니다.
   - 토큰의 만료 시간 등 클레임(claim)을 확인합니다.

7. 인증된 응답:
   - JWT가 유효하면, 서버는 요청을 인증된 것으로 처리하고 적절한 응답을 제공합니다.
   - JWT가 유효하지 않으면, 서버는 인증 오류를 반환합니다.

8. 토큰 갱신:
   - JWT는 일정 기간 후 만료되도록 설정됩니다.
   - 만료 전에 새로운 토큰을 발급받는 리프레시 메커니즘을 구현할 수 있습니다.

9. 로그아웃:
   - 클라이언트에서 저장된 JWT를 삭제합니다.
   - 서버 측에서 해당 토큰을 블랙리스트에 추가하여 무효화할 수 있습니다(선택적).


JWT는 간단하고 효율적인 인증 방식이지만, 토큰 관리와 보안에 주의가 필요합니다. 특히 중요한 정보는 JWT에 포함시키지 않는 것이 좋습니다.
