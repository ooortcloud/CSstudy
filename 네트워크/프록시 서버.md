## 프록시 서버(Proxy Server) 개념

프록시 서버는 클라이언트가 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해주는 중간 서버이다. 네트워크 보안 강화, 성능 최적화, 익명성 제공 등 다양한 목적으로 사용된다. 

주요 기능을 요약하면 다음과 같다:
- 클라이언트의 요청을 대신 전달
- 서버의 응답을 클라이언트에게 전달
- 클라이언트의 IP 주소를 숨김
- 캐싱을 통한 성능 향상
- 접근 제어 및 보안 강화

### 프록시 서버 종류

#### 포워드 프록시(Forward Proxy)

클라이언트 측에 위치한 프록시 서버이다. 클라이언트의 요청을 포워드 프록시 서버가 대신 목적지 서버에게 전달하고 응답을 받아서 넘겨준다. 이렇게 하면 서버 입장에서는 해당 요청이 클라이언트가 아닌 프록시 서버에서 왔다고 생각한다. 주로 IP 주소 숨김, 접근 제어, 캐싱을 목적으로 사용한다.

#### 리버스 프록시(Reverse Proxy)

서버 측에 위치한 프록시 서버이다. 리버스 프록시 서버는 클라이언트의 요청을 받은 후에, 이 요청을 처리하기에 적절한 서버로 전달한다. 포워드 프록시 서버와 다르게, 이 요청은 클라이언트의 요청임을 명시하며, 따라서 서버에서는 해당 요청이 클라이언트에서 왔음을 알 수 있다. 주로 로드 벨런싱, SSL 종료, 캐싱 등에 사용된다.

### 프록시 서버 작동 원리

1. 클라이언트는 프록시 서버로 요청을 보낸다.
2. 프록시 서버는 요청을 받아 목적지 서버로 전달한다.
   - 포워드 프록시 서버는 자신의 신분으로 목적지 서버에게 요청한다.
   - 리버스 프록시 서버는 클라이언트의 신분을 유지하며 목적지 서버에 요청한다.
3. 목적지 서버는 해당 요청을 처리한 후, 프록시 서버에게 응답을 반환한다.
4. 응답을 받은 프록시 서버는 그 응답을 그대로 클라이언트에게 전달한다.

프록시 서버는 이 과정 안에서 다음과 같은 작업을 수행할 수 있다:
- 요청과 응답 내용 수정
- 캐싱을 통한 응답 시간 단축
- 클라이언트의 IP 주소 변경
- 접근 제어와 로깅

## 주요 기능

### 캐싱과 성능 최적화

프록시 서버는 자주 요청되는 데이터를 저장하고 재사용할 수 있다. 이를 통해 서버의 부하를 줄이고, 네트워크 트래픽을 감소시키며, 클라이언트에게 빠른 응답을 제공할 수 있다.

### 보안 강화와 익명성 제공

프록시 서버는 보안 게이트웨이 역할을 수행할 수 있다. 외부로부터 내부 네트워크를 보호하고, 클라이언트의 실제 IP 주소를 숨기며, 요청을 암호화하여 클라이언트 정보를 숨길 수 있다.

### 로드 벨런싱

리버스 프록시 서버는 여러 서버에 트래픽을 분산시킨다. 이를 통해 서버의 부하를 균등하게 분배하며, 시스템의 안정성과 가용성을 향상시킨다.

### 접근 제어와 콘텐츠 필터링

프록시 서버는 네트워크 트래픽을 모니터링하고 제어할 수 있다. 특정 웹사이트나 콘텐츠에 대한 접근을 제한하고, 부적절한 콘텐츠를 차단할한다. 그래서 주로 기업이나 학교에서 인터넷 사용을 관리하는데 사용된다.

## 개발 환경에서의 프록시 활용

### CORS 문제 해결하기

CORS(Cross-Origin Resource Sharing) 정책으로 인해, 기본적으로 브라우저는 다른 출처(origin)에 대한 리소스 요청을 차단한다. 이는 보안상으로는 안전할지 몰라도, MSA 아키텍쳐 서비스를 운영하는 시스템에서는 각 서버 간의 통신을 못하게 막는 1순위 장애물이 된다. 

이 문제는 백엔드 서버 등에서 직접 설정해줄 수도 있지만, 프록시 서버를 사용해도 CORS 문제를 해결할 수 있다. 클라이언트의 모든 요청은 동일한 프록시 서버에서 받고, 프록시 서버는 뒤에서 해당 요청을 처리할 수 있는 서버에게 API 요청을 통해 처리한 뒤 그 응답을 클라이언트에게 반환하면, 클라이언트는 동일한 프록시 서버에 대해 요청하고 응답을 받는 구조가 되므로 CORS 문제를 우회할 수 있게 된다.

### 프론트엔드 프레임워크에서의 프록시 설정

React 프로젝트에서는 `package.json`에 다음의 프록시 설정을 추가할 수 있다:
```json
{
  "proxy": "http://localhost:4000"
}
```
이 설정을 넣어주면, React 서버는 API 요청을 지정된 주소로 프록시한다. 동작 과정은 다음과 같다:
1. 브라우저가 React 서버로 요청을 보낸다.
2. React 서버는 지정된 API 백엔드 서버로 요청을 전달한다.
3. API 백엔드 서버가 React 서버로 응답을 보낸다.
4. React 서버는 받은 응답을 브라우저에게 전달한다.

이 방식으로 인해, 브라우저 입장에서는 동일 Origin에서 통신이 이뤄지고 있다고 착각하여 CORS 문제를 우회할 수 있다.

## 보안과 프록시 서버

### HTTPS와 SSL/TLS 설정

프록시 서버는 HTTPS 통신을 사용하여 데이터를 암호화할 수 있다. 즉, SSL/TLS 프로토콜을 사용하여 클라이언트와 서버 간 안전한 통신 채널을 생성할 수 있다. TLS 1.2 또는 1.3과 같은 최신 프로토콜 버전을 사용하여 보안을 강화할 수 있다. 그리고 프록시 서버는 SSL 오프로딩을 수행하여 백엔드 서버의 부하를 줄일 수 있다.

> SSL 오프로딩: 목적지 서버 대신 SSL Handshake와 데이터 암복호화를 수행하여, 목적지 서버의 SSL 통신 부하를 제거하는 기술.

### 웹 어플리케이션 방화벽(WAF) 구현

프록시 서버는 WAF 기능을 통합하여 WAS를 보호할 수 있다. SQL 인젝션이나 XSS 등 전형적인 웹 공격을 탐지하고 차단하며, 악성 트래픽을 필터링하여 WAS로의 접근을 제한하고, 요청 및 응답 내용을 검사하여 데이터 유출을 방지할 수 있다.

### DDoS 공격 방어 전략

프록시 서버는 DDoS 공격에 대한 핵심 방어선 역할을 수행할 수 있다.
- **트래픽 분산**: 여러 서버에 부하를 분산시켜 단일 지점 방애를 막는다.
- **연속 요청 제한**: 특정 IP나 클라이언트로부터의 과도한 요청을 막는다.
- **패킷 필터링**: 비정상적인 패킷은 바로 차단한다.
- **블랙리스트/화이트리스트**: 악성 IP는 블랙리스트로 차단하고, 신뢰할 수 있는 IP는 화이트리스트에 등록하여 클라이언트 관리가 가능하다.

## 모니터링과 트러블 슈팅

### 프록시 서버 로그 분석

프록시 서버의 로그는 문제 진단과 성능 최적화를 위한 필수 전략이다. 그래서 엑세스 로그와 오류 로그를 주기적으로 검토해야 하며, 로그 회전을 설정하여 디스크 공관을 관리할 수 있다. 

그리고 로그 분석기 도구를 사용하면 로그 통계를 낼 수 있다. 주요 분석 항목은 다음과 같다:
- 가장 많이 엑세스된 URL
- 트래픽이 가장 많은 시간대
- 오류 코드 발생 빈도

### 성능 모니터링 도구 활용

아래와 같은 유형의 도구들을 활용하면 프록시 서버의 성능을 모니터링하기 유용하다:
- 시스템 리소스(CPU, 메모리, 디스크 I/O 등) 모니터링 도구
- 네트워크 트래픽 분석 도구
- 응답 시간 및 지연 시간 측정 도구
- 클라우드 기반 모니터링 서비스(ex. Google Cloud의 Cloud Service Mesh)

### 일반적인 문제 해결 방법

프록시 서버를 운영할 때 아래의 문제들은 다음의 방법으로 해결한다고 한다:
- 연결 문제: 네트워크 설정 및 방화벽 규칙을 다시 확인해보자.
- 성능 저하 문제: 캐시 설정을 최적화하고, 리로스 할당 방식을 조정해보자.
- 보안 이슈: 로그를 분석하여 비정상적인 패턴을 식별해보자.
- configuration 오류: 설정 파일을 검토하고 문법 오류를 수정하자.