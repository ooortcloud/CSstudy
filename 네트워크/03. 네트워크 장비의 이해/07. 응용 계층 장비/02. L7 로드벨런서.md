## 로드벨런서의 기본 개념

로드벨런서는 client와 server 그룹 사이에 위치하여, 외부 client의 네트워크 트래픽을 여러 server에 균등하게 분산시켜 시스템의 성능을 향상시키고 가용성을 높이는 장치 또는 소프트웨어이다.

### 필요성

- **트래픽 폭주 대응**: 수천만 명의 사용자가 동시 접속할 때 단일 server라면 과부하가 되었겠지만, 여러 server에 분산시키면 버텨낼 수 있다. 이 특성은 성능 최적화에도 도움을 준다.
- **서비스 안정성 확보**: client의 동시 접속 문제 외에도, 갑작스럽게 특정 server가 스스로 장애를 일으키는 경우로 인해 전체 서비스가 중단되는 경우를 막는 데에도 기여한다. 특정 서버가 마비돼도 다른 서버로 트래픽을 옮기면 그만이기 때문이다.
- **확장성 제공**: 필요하면 그 즉시 server scaling을 할 수 있어, 시스템의 유연한 확장 및 축소가 가능하다.

## L7 로드벨런서 특징

1. **패킷 분석**: 입력된 네트워크 패킷 내용을 심층적으로 분석한다.
2. **콘텐츠 기반 스위칭**: 분석된 패킷 정보를 바탕으로 해당 트래픽을 적당한 server로 분산시킨다.
3. **지능적 부하 분산**: 단순 IP와 port 정보를 넘어, application level의 데이터를 활용하면 더 정교한 부하 분산이 가능하다.(관련 내용은 바로 아래에서 후술)

## L7 로드벨런서 기능

L4 로드벨런서에 비해 패킷 내용을 더욱 깊게 분석해야 하기 때문에 처리 속도가 상대적으로 느리고 자원 소모가 큰 편이라는 단점이 있지만, 더욱 정교한 트래픽 관리와 리소스 최적화를 가능케 하는 장점이 있다. 성능적인 면보다 정교한 트래픽 관리가 중요한 경우 L7 로드벨런서를 채택할만하다.

### 세밀한 부하 분산 방식

아래의 application level 정보를 활용하여 세밀하게 트래픽 분산 처리가 가능하다.

- **URL 기반 라우팅**: 요청된 URL에 따라 특정 server로 트래픽을 전달한다.
- **HTTP 헤더 분석**: 요청의 헤더 정보를 기반으로 트래픽을 분산한다.
- **cookie 기반 분배**: 사용자의 cookie 정보를 활용하여 session의 일관성을 유지한다.(마지막에 접속한 server 정보를 기억해서 특정 server에 다시 접속하도록 유도할 수 있음)
- **payload 검사**: 요청 본문의 내용을 분석하여 적절한 server로 라우팅한다.

### 콘텐츠 기반 스위칭

- **application lever 정보 활용**: 앞서 소개한 부하 분산 방식을 기반으로 트래픽을 분산한다.
- **지능적 라우팅**: 요청 내용을 분석하여 특정 server로 전달할 수 있다. 예컨데, 결제 관련 요청은 결제 전용 서버로 라우팅할 수 있다.
- **보안**: 패킷 내용을 분석했을 때 악의적이거나 비정상적인 트래픽으로 판단되면 필터링 가능하다.

## L4 로드벨런서와 비교

|툭성|L4|L7|
|---|---|---|
|작동 계층|Transport Layer|Application Layer|
|로드벨런싱 기준|IP 주소와 port 정보만을 활용|application level 정보를 추가적으로 활용할 수 있음|
|처리 속도|상대적으로 빠른 편|상대적으로 느린 편|
|기능|제한적|다양한 기능과 높은 유연성 제공|

## L7 로드벨런서 활용 사례(vs L4)

### L7 로드벨런서

- 웹 서비스, API 게이트웨이
- CDN(Content Delivery Network)
- MSA 환경인 경우(ex. 결제 전용 서버, 회원가입 전용 서버 등으로 분리된 경우, 요청 분리 목적으로 사용)
- 악의적 트래픽 감지 및 필터링으로 보안 강화

### L4 로드벨런서

- 실시간 트래픽 처리 또는 빠른 응답이 중요한 서비스(온라인 게임, 스트리밍 서비스 등)
- 단순한 부하 분산만 필요한 경우