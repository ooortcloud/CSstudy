# 이더넷(Ethernet)
### 정의
이더넷은 유선 [근거리 통신망(LAN, Local Area Network)](../02.%20네트워크%20종류.md) 통신 표준이다. LAN에 연결된 네트워크 장치들은 서로 데이터 패킷을 주고 받을 수 있다. 이더넷은 'CSMA/CD' 프로토콜을 사용한다는 것이 가장 큰 특징이다.

## 이더넷 프레임(Frame)

![frame 이미지](../../이미지%20폴더/ethernet-frame.png)

이더넷 프레임은 데이터 링크 계층에서 사용되는 데이터 패킷의 기본 구조입니다. 이더넷 네트워크에서 데이터를 전송할 때 사용되는 형식으로, 다음과 같은 구조로 이루어져 있습니다:

1. Preamble (7 bytes):
   - 프레임의 시작을 알리는 비트 패턴
   - 수신 장치의 클록을 동기화하는 데 사용됨

2. Start Frame Delimiter (SFD) (1 byte):
   - 프레임의 실제 시작을 나타내는 특별한 비트 패턴

3. Destination MAC Address (6 bytes):
   - 목적지 장치의 물리적 주소

4. Source MAC Address (6 bytes):
   - 송신 장치의 물리적 주소

5. EtherType/Length (2 bytes):
   - 1500 이하: 페이로드의 길이를 나타냄
   - 1536 이상: 상위 계층 프로토콜 유형을 나타냄 (예: IPv4, IPv6, ARP)

6. Payload (46-1500 bytes):
   - 실제 데이터
   - 최소 46 바이트, 최대 1500 바이트

7. Frame Check Sequence (FCS) (4 bytes):
   - 오류 검출을 위한 순환 중복 검사(CRC) 값

주요 특징:
- 최소 프레임 크기: 64 bytes (페이로드 제외 시 18 bytes)
- 최대 프레임 크기: 1518 bytes (점보 프레임 제외)
- 프레임 간 간격 (Interframe Gap): 최소 96 bit times

이더넷 프레임은 네트워크 상에서 데이터를 안전하고 효율적으로 전송하기 위한 구조를 제공합니다. MAC 주소를 통해 정확한 송수신을 보장하고, 오류 검출 기능을 통해 데이터 무결성을 확인할 수 있습니다.

## CSMA/CD(Carrier Sense Multiple Address/Collision Detection)
'CSMA/CD'는 여러 네트워크 장치들이 동시에 통신할 때 발생하는 충돌 문제를 해결하기 위해 등장한 매체 접근 제어(MAC) `충돌 감지` 프로토콜이다.

### 흐름도

![flow](../../이미지%20폴더/csma-cd%20flow.png)

1. 시작: 스테이션이 전송할 프레임을 가지고 있습니다.

2. 초기화: 시도 횟수 K를 0으로 설정합니다.

3. 전송 시도: persistence 방법 중 하나를 적용하여 전송을 시도합니다.
    - 1-persistent : 짧은 시간동안 지속적으로 회선이 휴지상태인지 감지. 만약 휴지상태를 감지한 경우 즉시 자신의 데이터 프레임을 전송하는 전략
    - nonpersistent : 주기적으로 회선이 휴지상태인지 감지. 만약 휴지상태를 감지한 경우 자신의 데이터 프레임을 전송하는 전략
    - p-persistent :  짧은 시간동안 지속적으로 회선이 휴지상태인지 감지. 시스템에 설정한 확률에 따라 자신의 데이터를 보낼지 말지를 결정하는 전략. 전송 명령에 당첨되지 않은 경우, 일정한 시간 이후 다시 재시도.

4. 전송 결과 확인: 
   - 전송이 성공하거나 충돌이 감지되면 다음 단계로 이동합니다.
   - 그렇지 않으면 '전송 및 수신' 단계로 돌아갑니다.

5. 충돌 감지:
   - 충돌이 감지되면 jamming 신호를 보내고 K를 1 증가시킵니다.
   - 충돌이 없으면 성공적으로 종료합니다.

6. 최대 시도 횟수 확인: 
   - K가 최대값(보통 15)을 초과하면 전송을 중단합니다.
   - 그렇지 않으면 다음 단계로 진행합니다.

7. 백오프 시간 계산: 
   - 0에서 2^K - 1 사이의 랜덤 숫자 R을 선택합니다.
   - 백오프 시간 TB를 계산합니다 (TB = R * Tp 또는 R * Tfr).

8. 대기: TB 시간만큼 대기한 후 3단계로 돌아가 재시도합니다.

이 과정은 성공적인 전송이 이루어지거나 최대 시도 횟수에 도달할 때까지 반복됩니다.

### 충돌 감지 원리

![csma 취약시간](../../이미지%20폴더/csma-cd%20취약시간.png)
CSMA 구조에서 회선 내 충돌이 발생할 수밖에 없는 취약 시간은 자기 자신으로부터 해당  네트워크 장치까지 데이터를 전송하는 전파시간이다.

![csma 그림](../../이미지%20폴더/csma-cd.png)
위 그림에서 C - D 전파 시간은 $t_3 - t_2$이고, A - D 전파 시간은 $t_4 - t_1$이 된다. 프레임 충돌을 감지하는 즉시 A와 C는 전송을 중단한다. 

이렇게 충돌을 감지하기 위해서는 프레임의 최소 전송 시간이 반드시 최대 전파 시간의 2배 이상이어야 한다. 그래야 특정 노드의 프레임 전송이 완전히 끝나기 전에 다른 노드의 프레임을 감지하여 충돌을 감지할 수 있기 때문이다. 만약 프레임 전송이 모두 끝난 이후 뒤늦게 다른 노드의 프레임을 감지하게 되면, 내 프레임이 충돌했는지 못했는지 알 수 없기 때문이다. 이것이 프레임의 최소 크기가 존재하는 이유이다.


1. CSMA/CD의 기본 원리:

   - CS (Carrier Sense): 데이터를 전송하기 전에 네트워크 매체가 사용 중인지 감지합니다.
   - MA (Multiple Access): 여러 노드가 동시에 네트워크에 접근할 수 있습니다.
   - CD (Collision Detection): 충돌이 발생했을 때 이를 감지하고 대응합니다.

2. 충돌 탐지 과정:

   a. 전송 전 감지:
      - 노드는 데이터를 전송하기 전에 네트워크가 idle(사용 중이지 않음) 상태인지 확인합니다.

   b. 전송 시작:
      - 네트워크가 idle 상태이면 데이터 전송을 시작합니다.

   c. 전송 중 모니터링:
      - 데이터를 전송하는 동안 노드는 계속해서 네트워크를 모니터링합니다.

   d. 충돌 감지:
      - 만약 다른 노드가 동시에 전송을 시작했다면, 신호의 충돌이 발생합니다.
      - 충돌은 전압 레벨의 비정상적인 상승으로 감지됩니다.

   e. 재밍 신호 전송:
    > 재밍 신호(Jam Signal) : 이더넷 프레임의 송출 노드가 프레임의 충돌을 감지하면, 현재 LAN 내 다른 노드들에게 그 여부를 알리기 위해 보내는 32-bit의 특별한 의미없는 데이터
      - 충돌을 감지한 노드는 재밍 신호(jam signal)를 네트워크에 전송합니다.
      - 이는 다른 모든 노드에게 충돌이 발생했음을 알리는 역할을 합니다.

   f. 백오프 시간 계산:
      - 충돌 후, 각 노드는 랜덤한 시간 동안 대기합니다 (백오프 시간).
      - 이 시간은 이진 지수 백오프 알고리즘을 사용하여 계산됩니다.

   g. 재전송:
      - 백오프 시간이 지난 후, 노드는 다시 전송을 시도합니다.

3. 충돌 탐지의 물리적 원리:

   - 전압 레벨 모니터링: 노드는 네트워크 케이블의 전압 레벨을 지속적으로 모니터링합니다.
   - 정상 전압 vs 충돌 전압: 충돌 시 전압 레벨이 정상 전송 시보다 높아집니다.
   - 시간 임계값: 충돌은 매우 짧은 시간 내에 감지되어야 합니다 (일반적으로 수 마이크로초 이내).

4. 충돌 도메인:

   - CSMA/CD는 모든 노드가 동일한 충돌 도메인 내에 있을 때 효과적으로 작동합니다.
   - 허브를 사용하는 네트워크에서는 모든 포트가 하나의 충돌 도메인을 형성합니다.

5. 한계와 극복:

   - 네트워크 크기 제한: 충돌을 효과적으로 감지하기 위해 네트워크 크기에 제한이 있습니다.
   - 스위치 사용: 현대 네트워크에서는 스위치를 사용하여 충돌 도메인을 분리하고, CSMA/CD의 필요성을 줄입니다.

6. 효율성:

   - 네트워크 부하가 낮을 때 효율적입니다.
   - 부하가 높아질수록 충돌 빈도가 증가하여 효율성이 떨어집니다.

CSMA/CD의 충돌 탐지 메커니즘은 공유 매체 이더넷에서 데이터 충돌을 효과적으로 관리하고, 네트워크의 안정성을 유지하는 데 중요한 역할을 합니다. 그러나 현대의 고속 네트워크에서는 스위치 기반 전이중 통신(full-duplex)이 주로 사용되어, CSMA/CD의 필요성이 크게 줄어들었습니다.

## 이더넷 규격
이더넷 규격은 곧 랜선의 데이터 전송 속도와 직결된다. 일반적으로 많이 사용하는 이더넷 규격은 `1000BASE-T /  100BASE-TX / 10BASE-T`가 있다.


