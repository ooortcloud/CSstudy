## 데이터베이스 인덱스: 빠른 데이터 검색을 위한 길잡이

> index: (데이터베이스) 테이블에 대한 동작 속도를 높여주는 '자료구조'.

**데이터베이스 인덱스**는 책의 목차와 비슷한 역할을 합니다. 책의 본문에서 특정 내용을 찾을 때, 목차를 먼저 보고 해당 페이지를 찾아가는 것처럼, 데이터베이스에서도 인덱스를 통해 원하는 데이터를 빠르게 찾을 수 있습니다.

데이터베이스 인덱스는 일반적으로 테이블과 동일한 디스크에 저장되거나, 별도의 인덱스 파일로 관리될 수 있다. 결국 디스크에 저장하게 되는데, 디스크에 저장해야 데이터 지속성을 보장할 수 있기 때문이다.(데이터 지속성이 필요없다면, 차라리 캐시 서버를 만들어서 조회 성능을 높이는 것이 대안이 될 수 있다.)

일반적으로 테이블을 생성하면, DBMS는 PK 컬럼에 대한 인덱스를 자동으로 생성하여 관리한다.

### 인덱스의 역할

* **빠른 데이터 검색:** 인덱스는 테이블의 특정 컬럼에 대한 정렬된 데이터 구조입니다. 이를 통해 데이터베이스는 전체 테이블을 순차적으로 검색하지 않고, 인덱스를 이용하여 원하는 데이터를 빠르게 찾을 수 있습니다.
* **정렬 및 그룹화 성능 향상:** `ORDER BY` 또는 `GROUP BY` 절을 사용할 때 인덱스가 존재하면 쿼리 성능이 크게 향상됩니다.

### 인덱스 종류

* **B+ 트리 인덱스:** 가장 일반적으로 사용되는 인덱스 형태로, 범위 검색에 효율적입니다.(동작 방식은 추후에 자세히 알아본다.)
* **해시 인덱스:** 정확한 값을 찾는 데 효율적이지만, 범위 검색에는 적합하지 않습니다.
* **비트맵 인덱스:** 특정 값의 존재 여부를 빠르게 확인하는 데 사용됩니다.


## 인덱스의 작동 원리

인덱스는 B+ 트리와 같은 자료 구조를 사용하여 구현됩니다. B+ 트리의 각 노드는 키 값과 해당 키 값을 가진 데이터의 위치를 가리키는 포인터를 가지고 있습니다. 데이터베이스는 이러한 인덱스를 이용하여 원하는 데이터를 빠르게 찾아낼 수 있습니다.

### 인덱스의 기본 개념

* **목적:** 특정 컬럼의 값을 기준으로 데이터를 빠르게 찾기 위한 자료 구조입니다.
* **구성:** 일반적으로 검색 키(key)와 데이터를 가리키는 포인터(pointer)로 구성됩니다. 검색 키는 인덱스를 생성할 때 지정한 컬럼의 값이며, 포인터는 실제 데이터가 저장된 위치를 가리킵니다.
* **자료 구조:** B+ 트리, 해시 테이블 등 다양한 자료 구조를 사용하여 구현됩니다.

### 인덱스의 동작 원리

1. **인덱스 생성:** 특정 컬럼에 대한 인덱스를 생성하면 데이터베이스 시스템은 해당 컬럼의 값을 기준으로 정렬된 인덱스를 생성합니다. 이 인덱스는 메모리 또는 디스크에 별도로 저장됩니다.
2. **데이터 검색:**
   * 데이터베이스 시스템은 쿼리에서 지정된 조건에 맞는 데이터를 찾기 위해 먼저 인덱스를 검색합니다.
   * 인덱스를 통해 찾은 키 값에 해당하는 포인터를 따라 실제 데이터가 저장된 위치로 이동하여 데이터를 가져옵니다.
   * 인덱스는 이진 탐색과 유사한 방식으로 빠르게 원하는 데이터를 찾을 수 있도록 도와줍니다.

### B+ 트리 기반 인덱스의 예시

B+ 트리는 데이터베이스에서 가장 많이 사용되는 인덱스 자료 구조 중 하나입니다. B+ 트리는 다음과 같은 특징을 가지고 있습니다.

* **균형 잡힌 트리:** 모든 리프 노드가 루트 노드에서 동일한 거리에 위치하도록 구성되어 있습니다.
* **리프 노드 연결:** 모든 리프 노드가 연결 리스트로 연결되어 있어 범위 검색에 유리합니다.
* **큰 팬아웃:** 각 노드가 가질 수 있는 자식 노드의 수가 많아 디스크 I/O를 최소화할 수 있습니다.

**B+ 트리의 동작 예시:**

1. **검색:** 검색할 키 값을 루트 노드와 비교하여 적절한 자식 노드를 선택합니다. 이 과정을 반복하여 키 값이 일치하는 노드를 찾습니다.
2. **삽입:** 삽입할 키 값을 적절한 위치에 삽입하고, 노드가 가득 차면 노드를 분할합니다.
3. **삭제:** 삭제할 키 값을 찾아 삭제하고, 필요에 따라 인접한 노드와 병합하거나 키를 재배치합니다.

## 인덱스 설정 시 고려 사항

데이터베이스에서 인덱스를 설정하는 것은 쿼리 성능을 향상시키는 데 매우 중요하지만, 잘못된 인덱스는 오히려 성능을 저하시킬 수도 있습니다. 따라서 인덱스를 생성할 때 다음과 같은 사항들을 고려해야 합니다.

### 1. 자주 사용되는 컬럼에 대한 인덱스 생성

* **WHERE 절에 자주 사용되는 컬럼:** 특정 값을 찾기 위해 자주 사용되는 컬럼에 인덱스를 생성하면 검색 속도를 크게 향상시킬 수 있습니다.
* **JOIN 조건에 사용되는 컬럼:** JOIN 조건에 사용되는 컬럼에 인덱스를 생성하면 테이블 간의 연결 성능을 향상시킬 수 있습니다.
* **ORDER BY 절에 사용되는 컬럼:** 데이터를 정렬할 때 자주 사용되는 컬럼에 인덱스를 생성하면 정렬 속도를 향상시킬 수 있습니다.
* **GROUP BY 절에 사용되는 컬럼:** 데이터를 그룹화할 때 자주 사용되는 컬럼에 인덱스를 생성하면 그룹화 성능을 향상시킬 수 있습니다.

### 2. 인덱스의 종류 고려

* **B+ 트리 인덱스:** 가장 일반적인 인덱스 형태로, 범위 검색에 효율적입니다.
* **해시 인덱스:** 정확한 값을 찾는 데 효율적이지만, 범위 검색에는 적합하지 않습니다.
* **비트맵 인덱스:** 특정 값의 존재 여부를 빠르게 확인하는 데 사용됩니다.

### 3. 인덱스의 개수

* **필요한 인덱스만 생성:** 모든 컬럼에 인덱스를 생성하는 것은 오히려 성능 저하를 야기할 수 있습니다. 자주 사용되는 컬럼에 대해서만 인덱스를 생성하는 것이 좋습니다.
* **복합 인덱스:** 여러 컬럼을 조합하여 하나의 인덱스를 생성할 수 있습니다. 복합 인덱스는 여러 컬럼을 조건으로 검색할 때 효과적입니다.

### 4. 인덱스 크기 고려

* **인덱스는 데이터베이스 공간을 차지**합니다. 너무 많은 인덱스를 생성하면 디스크 공간을 많이 차지하고, 데이터 변경 시 인덱스 업데이트 오버헤드가 발생할 수 있습니다.

### 5. 인덱스 관리

* **정기적인 검토:** 데이터베이스 시스템이 제공하는 쿼리 분석 도구를 활용하여 인덱스 사용 현황을 분석하고, 불필요한 인덱스는 삭제해야 합니다.
* **데이터 변경 시 인덱스 재구축:** 데이터가 많이 변경된 경우 인덱스를 재구축하여 성능 저하를 방지해야 합니다.

### 인덱스 생성 시 주의사항

* **NULL 값:** NULL 값이 많은 컬럼에 인덱스를 생성하면 인덱스 효율이 떨어질 수 있습니다.
* **데이터 분포:** 데이터가 특정 값에 편중되어 있으면 인덱스 효율이 떨어질 수 있습니다.
* **인덱스 크기:** 인덱스 크기가 너무 크면 디스크 I/O가 증가하여 성능이 저하될 수 있습니다.

**결론적으로, 인덱스는 데이터베이스 성능을 향상시키는 중요한 요소이지만, 무턱대고 많은 인덱스를 생성하는 것은 오히려 역효과를 낼 수 있습니다.** 쿼리 패턴을 분석하고, 데이터 특성을 고려하여 적절한 인덱스를 생성해야 합니다.


* **추가적으로 알아두면 좋은 것:**
    * **복합 인덱스:** 여러 컬럼을 기반으로 생성하는 인덱스
    * **유니크 인덱스:** 중복된 값을 허용하지 않는 인덱스
    * **클러스터드 인덱스:** 데이터를 물리적으로 정렬하는 인덱스

