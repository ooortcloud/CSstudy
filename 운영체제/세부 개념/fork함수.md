**`fork()` 함수**는 유닉스 계열 운영체제(예: Linux)에서 새로운 프로세스를 생성하는 데 사용되는 시스템 호출입니다. `fork()`는 기존 프로세스(부모 프로세스)를 복사하여 새로운 프로세스(자식 프로세스)를 만들어냅니다. 이 자식 프로세스는 부모 프로세스의 거의 모든 속성을 그대로 복사한 동일한 환경에서 실행됩니다. 다만, 자식 프로세스는 고유한 프로세스 ID(PID)를 갖고, 독립적으로 실행됩니다.

`fork()`는 멀티태스킹 운영체제에서 중요한 역할을 하며, 새로운 프로세스를 효율적으로 생성하는 방식 중 하나입니다.

### 1. `fork()` 함수의 동작 방식

`fork()`를 호출하면 다음 두 가지 프로세스가 생깁니다:

- **부모 프로세스(Parent Process)**: 기존에 실행 중이던 프로세스.
- **자식 프로세스(Child Process)**: `fork()`를 호출함으로써 새롭게 생성된 프로세스.

#### 주요 특징:
- **프로세스 복사**: 자식 프로세스는 부모 프로세스의 복사본입니다. 이는 부모 프로세스의 코드, 데이터, 열린 파일, 환경 변수를 모두 상속받습니다.
- **고유한 PID**: 자식 프로세스는 새로운 프로세스 ID(PID)를 부여받아 부모 프로세스와 구별됩니다.
- **별도의 메모리 공간**: 자식 프로세스는 부모 프로세스의 메모리를 복사하지만, 부모와 자식은 서로 다른 메모리 공간을 사용하므로 서로 독립적으로 동작합니다.
- **복사-쓰기 (Copy-on-Write)**: 메모리 효율성을 위해 운영체제는 메모리의 실제 복사를 최소화하기 위해 "복사-쓰기(Copy-on-Write)" 기술을 사용합니다. 즉, 자식과 부모는 처음에는 동일한 메모리 페이지를 참조하지만, 어느 한쪽에서 해당 페이지를 수정할 때 복사가 발생합니다.

### 2. `fork()` 함수의 반환 값

`fork()`는 호출한 프로세스에 대해 두 가지 값을 반환합니다:

- **부모 프로세스**: `fork()`는 부모 프로세스에서 **자식 프로세스의 PID**를 반환합니다. 이를 통해 부모는 자식 프로세스의 생성 여부를 확인할 수 있습니다.
- **자식 프로세스**: `fork()`는 자식 프로세스에서 **0**을 반환합니다. 이를 통해 자식 프로세스는 자신이 새롭게 생성된 자식임을 인식할 수 있습니다.

만약 `fork()`가 실패하면, **-1**을 반환하고, 이 경우 프로세스 생성에 실패했음을 의미합니다.

### 3. `fork()`의 사용 예시

아래는 `fork()` 함수가 어떻게 동작하는지 보여주는 간단한 C 프로그램입니다:

```c
#include <stdio.h>
#include <unistd.h>

int main() {
    pid_t pid;
    
    // fork 호출
    pid = fork();
    
    // fork 실패 시
    if (pid < 0) {
        printf("Fork failed!\n");
        return 1;
    }
    
    // 자식 프로세스일 경우
    else if (pid == 0) {
        printf("This is the child process. PID: %d\n", getpid());
    }
    
    // 부모 프로세스일 경우
    else {
        printf("This is the parent process. Child PID: %d\n", pid);
    }
    
    return 0;
}
```

#### 실행 결과:
```
This is the parent process. Child PID: 12345
This is the child process. PID: 12345
```

- 부모 프로세스는 자식 프로세스의 PID를 출력하고, 자식 프로세스는 자신의 PID를 출력합니다.
- `fork()`는 두 번 실행되는 것처럼 보이지만, 실제로는 부모와 자식 프로세스에서 각각 다른 코드 경로를 실행합니다.

### 4. `fork()` 이후 프로세스 동작

`fork()`로 생성된 부모와 자식 프로세스는 동일한 코드에서 실행되지만, 서로 독립된 흐름을 가집니다. 따라서 부모와 자식이 다르게 동작해야 한다면, `fork()`의 반환 값을 사용하여 프로세스마다 다른 처리를 할 수 있습니다.

#### 주요 차이점:
- 부모 프로세스는 자식 프로세스의 PID를 이용해 자식 프로세스를 추적할 수 있습니다.
- 자식 프로세스는 자신이 새로운 프로세스임을 알고, 부모와 다른 동작을 수행할 수 있습니다.

### 5. `fork()`와 프로세스 관계

#### 5.1. 부모-자식 관계:
- 자식 프로세스는 부모 프로세스의 PID를 `getppid()` 함수를 통해 확인할 수 있습니다.
- 부모 프로세스는 자식 프로세스의 종료를 추적하기 위해 `wait()` 또는 `waitpid()`를 호출하여 자식 프로세스가 종료될 때까지 대기하거나, 자식 프로세스의 종료 상태를 확인할 수 있습니다.

#### 5.2. 좀비 프로세스(Zombie Process):
- 자식 프로세스가 종료되었으나 부모 프로세스가 이를 수거하지 않으면, 자식 프로세스는 **좀비 프로세스** 상태가 됩니다.
- 부모가 `wait()`를 호출해 자식의 종료 상태를 수거하면 좀비 프로세스가 제거됩니다.

### 6. `fork()`의 응용

#### 6.1. 부모와 자식의 작업 분담:
`fork()`를 사용하면 부모 프로세스와 자식 프로세스가 독립적으로 작업을 수행할 수 있습니다. 예를 들어, 부모 프로세스는 입출력 작업을 수행하고, 자식 프로세스는 계산 작업을 수행하는 방식으로 병렬 처리가 가능합니다.

#### 6.2. 다중 프로세스:
`fork()`를 여러 번 호출하여 여러 자식 프로세스를 생성할 수 있습니다. 이를 통해 동시에 여러 작업을 수행할 수 있습니다.

### 7. `fork()` vs `exec()`

`fork()`는 부모 프로세스의 복사본을 만드는 것과 달리, **`exec()`** 계열 함수는 새로운 프로그램을 실행하는 데 사용됩니다. 일반적으로 `fork()`를 통해 자식 프로세스를 생성한 후, 자식 프로세스는 `exec()`를 호출해 다른 프로그램을 실행합니다. 이 두 함수는 결합되어 자주 사용됩니다.

예를 들어, `fork()`로 새로운 프로세스를 만들고, 그 자식 프로세스에서 `exec()`를 호출하여 새로운 프로그램을 실행할 수 있습니다.

---

### 요약

- **`fork()`**는 새로운 프로세스를 생성하는 시스템 호출입니다.
- **부모 프로세스**는 자식의 PID를 반환받고, **자식 프로세스**는 0을 반환받습니다.
- 자식 프로세스는 부모의 거의 모든 속성을 복사하지만, 별도의 PID와 메모리 공간을 가집니다.
- 자식 프로세스는 부모 프로세스와 독립적으로 실행됩니다.
- `fork()`는 멀티프로세싱을 구현하거나, 다른 프로그램을 실행하기 위한 기초로 사용됩니다.
